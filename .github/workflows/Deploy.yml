name: Deploy and Run nonstandardcode.py

on: [push, pull_request]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Checkout the repository to access the workflow file
      - name: 🔄 Checkout Repository
        uses: actions/checkout@v3

      # Step 2: Conda Setup
      - name: 🌿 Set up Miniconda
        uses: conda-incubator/setup-miniconda@v2
        with:
          auto-update-conda: true
          python-version: 3.10
          miniconda-version: "latest"
          environment-file: env.yml

      # Step 3: Download the Build Artifact
      - name: ⬇️ Download Build Artifacts
        uses: actions/download-artifact@v2
        with:
          name: build-artifacts
          path: ./artifact

      # Step 4: Install the Package from the Artifact
      - name: 📦 Install Package
        run: |
          # Navigate to the artifact location
          cd ./artifact
          # Install the package from the .whl or .tar.gz file in the dist directory
          pip install dist/*.whl

      # Step 5: Run nonstandardcode.py from the installed package
      - name: ▶️ Run nonstandardcode.py
        run: |
          # Running the Python script from the installed package
          python -c "import nonstandardcode; nonstandardcode.main()"
